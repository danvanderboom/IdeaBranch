<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:IdeaBranch.App.ViewModels"
             xmlns:domain="clr-namespace:IdeaBranch.Domain;assembly=IdeaBranch.Domain"
             xmlns:res="clr-namespace:IdeaBranch.App.Resources"
             x:Class="IdeaBranch.App.Views.NotificationsPage"
             x:DataType="vm:NotificationsViewModel"
             Title="{x:Static res:AppResources.NotificationsPage_Title}"
             AutomationId="NotificationsPage">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Header with Clear All button -->
        <Border Grid.Row="0"
                BackgroundColor="{StaticResource Gray100}"
                Padding="16,12">
            <Grid ColumnDefinitions="*,Auto">
                <Label Grid.Column="0"
                       Text="{x:Static res:AppResources.NotificationsPage_Header}"
                       FontSize="20"
                       FontAttributes="Bold"
                       VerticalOptions="Center"
                       SemanticProperties.HeadingLevel="Level1" />
                <Button Grid.Column="1"
                        Text="{x:Static res:AppResources.NotificationsPage_ClearAllButton}"
                        Clicked="OnClearAllClicked"
                        AutomationId="NotificationsPage_ClearAllButton"
                        IsEnabled="{Binding Notifications.Count, Converter={StaticResource CountToBoolConverter}}"
                        Padding="12,6"
                        SemanticProperties.Description="Removes all notifications from the list" />
            </Grid>
        </Border>

        <!-- Notifications list -->
        <RefreshView Grid.Row="1"
                     IsRefreshing="{Binding IsLoading}"
                     Refreshing="OnRefresh">
            <CollectionView ItemsSource="{Binding Notifications}"
                            SelectionMode="None"
                            EmptyView="{x:Static res:AppResources.NotificationsPage_EmptyView}">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="domain:NotificationItem">
                        <Grid Padding="16,12"
                              ColumnDefinitions="*,Auto,Auto"
                              AutomationId="{Binding Id, StringFormat='NotificationsPage_Notification_{0}'}">
                            <StackLayout Grid.Column="0"
                                         Spacing="4">
                                <Label Text="{Binding Title}"
                                       FontSize="16"
                                       FontAttributes="{Binding IsRead, Converter={StaticResource InvertedBoolToFontAttributesConverter}}"
                                       AutomationId="{Binding Id, StringFormat='NotificationsPage_Notification_{0}_Title'}" />
                                <Label Text="{Binding Message}"
                                       FontSize="14"
                                       TextColor="Gray"
                                       LineBreakMode="WordWrap"
                                       AutomationId="{Binding Id, StringFormat='NotificationsPage_Notification_{0}_Message'}" />
                                <Label Text="{Binding CreatedAt, StringFormat='{0:g}'}"
                                       FontSize="12"
                                       TextColor="LightGray"
                                       AutomationId="{Binding Id, StringFormat='NotificationsPage_Notification_{0}_CreatedAt'}" />
                            </StackLayout>
                            <Button Grid.Column="1"
                                    Text="{x:Static res:AppResources.NotificationsPage_MarkReadButton}"
                                    CommandParameter="{Binding .}"
                                    Clicked="OnToggleReadClicked"
                                    Padding="8,4"
                                    FontSize="12"
                                    Margin="8,0,0,0"
                                    IsVisible="{Binding IsRead, Converter={StaticResource InvertedBoolConverter}}"
                                    AutomationId="{Binding Id, StringFormat='NotificationsPage_Notification_{0}_MarkReadButton'}"
                                    SemanticProperties.Hint="Marks this notification as read" />
                            <Button Grid.Column="2"
                                    Text="{x:Static res:AppResources.NotificationsPage_DeleteButton}"
                                    CommandParameter="{Binding .}"
                                    Clicked="OnDeleteClicked"
                                    Padding="8,4"
                                    FontSize="12"
                                    Margin="8,0,0,0"
                                    BackgroundColor="Red"
                                    TextColor="White"
                                    AutomationId="{Binding Id, StringFormat='NotificationsPage_Notification_{0}_DeleteButton'}"
                                    SemanticProperties.Hint="Deletes this notification from the list" />
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>

        <!-- Loading indicator -->
        <ActivityIndicator Grid.Row="1"
                           IsRunning="{Binding IsLoading}"
                           IsVisible="{Binding IsLoading}"
                           HorizontalOptions="Center"
                           VerticalOptions="Center" />
    </Grid>
</ContentPage>

