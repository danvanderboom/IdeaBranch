<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:IdeaBranch.App.ViewModels"
             xmlns:res="clr-namespace:IdeaBranch.App.Resources"
             x:Class="IdeaBranch.App.Views.SettingsPage"
             x:DataType="vm:SettingsViewModel"
             Title="{x:Static res:AppResources.SettingsPage_Title}">
    <Grid ColumnDefinitions="240,*">
        <!-- Category list -->
        <Border Grid.Column="0"
                StrokeThickness="0"
                BackgroundColor="{StaticResource Gray100}">
            <CollectionView ItemsSource="{Binding Categories}"
                            SelectionMode="Single"
                            SelectedItem="{Binding SelectedCategory}"
                            SelectionChanged="OnCategorySelectionChanged">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid Padding="12,8">
                            <Label Text="{Binding .}"
                                   FontSize="16"
                                   VerticalOptions="Center"
                                   AutomationId="{Binding ., StringFormat='SettingsCategory_{0}'}"/>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Border>

        <!-- Detail panel -->
        <ScrollView Grid.Column="1" Padding="16">
            <StackLayout Spacing="16">
                <!-- User Category -->
                <StackLayout IsVisible="{Binding SelectedCategoryKey, Converter={StaticResource StringToVisibilityConverter}, ConverterParameter=User}"
                             Spacing="12">
                    <Label Text="{x:Static res:AppResources.SettingsPage_UserSettingsTitle}"
                           FontSize="24"
                           FontAttributes="Bold"
                           AutomationId="UserSettingsTitle"
                           SemanticProperties.HeadingLevel="Level1"/>
                    <Label Text="{x:Static res:AppResources.SettingsPage_UserSettingsComingSoon}"
                           FontSize="14"
                           TextColor="Gray"/>
                </StackLayout>

                <!-- Project Category -->
                <StackLayout IsVisible="{Binding SelectedCategoryKey, Converter={StaticResource StringToVisibilityConverter}, ConverterParameter=Project}"
                             Spacing="12">
                    <Label Text="{x:Static res:AppResources.SettingsPage_ProjectSettingsTitle}"
                           FontSize="24"
                           FontAttributes="Bold"
                           AutomationId="ProjectSettingsTitle"
                           SemanticProperties.HeadingLevel="Level1"/>
                    <Label Text="{x:Static res:AppResources.SettingsPage_ProjectSettingsComingSoon}"
                           FontSize="14"
                           TextColor="Gray"/>
                </StackLayout>

                <!-- Display Category -->
                <StackLayout IsVisible="{Binding SelectedCategoryKey, Converter={StaticResource StringToVisibilityConverter}, ConverterParameter=Display}"
                             Spacing="12">
                    <Label Text="{x:Static res:AppResources.SettingsPage_DisplaySettingsTitle}"
                           FontSize="24"
                           FontAttributes="Bold"
                           AutomationId="DisplaySettingsTitle"
                           SemanticProperties.HeadingLevel="Level1"/>
                    
                    <StackLayout Spacing="8">
                        <Label Text="{x:Static res:AppResources.SettingsPage_LanguageLabel}"
                               FontSize="16"
                               FontAttributes="Bold"/>
                        <Picker ItemsSource="{Binding LanguageOptions}"
                                SelectedItem="{Binding SelectedLanguage}"
                                AutomationId="LanguagePicker"
                                SemanticProperties.Description="Select the language for the application interface">
                            <Picker.ItemDisplayBinding>
                                <Binding Path="."/>
                            </Picker.ItemDisplayBinding>
                        </Picker>
                        <Label Text="{x:Static res:AppResources.SettingsPage_LanguageRestartNote}"
                               FontSize="12"
                               TextColor="Gray"
                               Margin="0,4,0,0"/>
                    </StackLayout>
                </StackLayout>

                <!-- Search/Filter Category -->
                <StackLayout IsVisible="{Binding SelectedCategoryKey, Converter={StaticResource StringToVisibilityConverter}, ConverterParameter=Search/Filter}"
                             Spacing="12">
                    <Label Text="{x:Static res:AppResources.SettingsPage_SearchFilterSettingsTitle}"
                           FontSize="24"
                           FontAttributes="Bold"
                           AutomationId="SearchFilterSettingsTitle"
                           SemanticProperties.HeadingLevel="Level1"/>
                    <Label Text="{x:Static res:AppResources.SettingsPage_SearchFilterSettingsComingSoon}"
                           FontSize="14"
                           TextColor="Gray"/>
                </StackLayout>

                <!-- Integrations Category -->
                <StackLayout IsVisible="{Binding SelectedCategoryKey, Converter={StaticResource StringToVisibilityConverter}, ConverterParameter=Integrations}"
                             Spacing="12">
                    <Label Text="{x:Static res:AppResources.SettingsPage_IntegrationSettingsTitle}"
                           FontSize="24"
                           FontAttributes="Bold"
                           AutomationId="IntegrationsSettingsTitle"
                           SemanticProperties.HeadingLevel="Level1"/>
                    
                    <StackLayout Spacing="16">
                        <!-- Provider Selection -->
                        <StackLayout Spacing="8">
                            <Label Text="{x:Static res:AppResources.SettingsPage_LlmProviderLabel}"
                                   FontSize="16"
                                   FontAttributes="Bold"/>
                            <Picker ItemsSource="{Binding ProviderOptions}"
                                    SelectedItem="{Binding Provider}"
                                    AutomationId="ProviderPicker"
                                    SemanticProperties.Description="Select the language model provider for AI features">
                                <Picker.ItemDisplayBinding>
                                    <Binding Path="."/>
                                </Picker.ItemDisplayBinding>
                            </Picker>
                        </StackLayout>

                        <!-- LM Studio Settings -->
                        <StackLayout IsVisible="{Binding Provider, Converter={StaticResource StringToVisibilityConverter}, ConverterParameter=lmstudio}"
                                     Spacing="8">
                            <Label Text="{x:Static res:AppResources.SettingsPage_LmStudioConfigurationTitle}"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   Margin="0,8,0,0"/>
                            <StackLayout Spacing="8">
                                <Label Text="{x:Static res:AppResources.SettingsPage_EndpointLabel}"
                                       FontSize="14"/>
                                <Entry Text="{Binding LmEndpoint}"
                                       Placeholder="http://localhost:1234/v1"
                                       AutomationId="LmEndpointEntry"
                                       SemanticProperties.Hint="Enter the endpoint URL for LM Studio API"/>
                            </StackLayout>
                            <StackLayout Spacing="8">
                                <Label Text="{x:Static res:AppResources.SettingsPage_ModelLabel}"
                                       FontSize="14"/>
                                <Entry Text="{Binding LmModel}"
                                       Placeholder="phi-4"
                                       AutomationId="LmModelEntry"
                                       SemanticProperties.Hint="Enter the model name to use with LM Studio"/>
                            </StackLayout>
                        </StackLayout>

                        <!-- Azure Settings -->
                        <StackLayout IsVisible="{Binding Provider, Converter={StaticResource StringToVisibilityConverter}, ConverterParameter=azure}"
                                     Spacing="8">
                            <Label Text="{x:Static res:AppResources.SettingsPage_AzureOpenAiConfigurationTitle}"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   Margin="0,8,0,0"/>
                            <StackLayout Spacing="8">
                                <Label Text="{x:Static res:AppResources.SettingsPage_EndpointLabel}"
                                       FontSize="14"/>
                                <Entry Text="{Binding AzureEndpoint}"
                                       Placeholder="https://your-resource.openai.azure.com"
                                       AutomationId="AzureEndpointEntry"
                                       SemanticProperties.Hint="Enter the Azure OpenAI endpoint URL"/>
                            </StackLayout>
                            <StackLayout Spacing="8">
                                <Label Text="{x:Static res:AppResources.SettingsPage_DeploymentLabel}"
                                       FontSize="14"/>
                                <Entry Text="{Binding AzureDeployment}"
                                       Placeholder="deployment-name"
                                       AutomationId="AzureDeploymentEntry"
                                       SemanticProperties.Hint="Enter the Azure deployment name"/>
                            </StackLayout>
                            <StackLayout Spacing="8">
                                <Label Text="{x:Static res:AppResources.SettingsPage_ApiKeyLabel}"
                                       FontSize="14"/>
                                <Entry Text="{Binding AzureApiKey}"
                                       Placeholder="{x:Static res:AppResources.SettingsPage_ApiKeyPlaceholder}"
                                       IsPassword="True"
                                       AutomationId="AzureApiKeyEntry"
                                       SemanticProperties.Hint="Enter the Azure OpenAI API key"/>
                            </StackLayout>
                        </StackLayout>
                    </StackLayout>
                </StackLayout>

                <!-- Notifications Category -->
                <StackLayout IsVisible="{Binding SelectedCategoryKey, Converter={StaticResource StringToVisibilityConverter}, ConverterParameter=Notifications}"
                             Spacing="12">
                    <Label Text="{x:Static res:AppResources.SettingsPage_NotificationSettingsTitle}"
                           FontSize="24"
                           FontAttributes="Bold"
                           AutomationId="NotificationsSettingsTitle"
                           SemanticProperties.HeadingLevel="Level1"/>
                    
                    <StackLayout Spacing="16">
                        <StackLayout Spacing="8">
                            <Label Text="{x:Static res:AppResources.SettingsPage_InAppNotificationsLabel}"
                                   FontSize="16"
                                   FontAttributes="Bold"/>
                            <Label Text="{x:Static res:AppResources.SettingsPage_InAppNotificationsDescription}"
                                   FontSize="14"
                                   TextColor="Gray"/>
                            <Switch IsToggled="{Binding InAppNotificationsEnabled}"
                                    AutomationId="InAppNotificationsSwitch"
                                    SemanticProperties.Hint="Toggle to enable or disable in-app notifications"/>
                        </StackLayout>

                        <StackLayout Spacing="8">
                            <Label Text="{x:Static res:AppResources.SettingsPage_PushNotificationsLabel}"
                                   FontSize="16"
                                   FontAttributes="Bold"/>
                            <Label Text="{x:Static res:AppResources.SettingsPage_PushNotificationsDescription}"
                                   FontSize="14"
                                   TextColor="Gray"/>
                            <Switch IsToggled="{Binding PushNotificationsEnabled}"
                                    AutomationId="PushNotificationsSwitch"
                                    SemanticProperties.Hint="Toggle to enable or disable push notifications"/>
                        </StackLayout>
                    </StackLayout>
                </StackLayout>

                <!-- AI Safety Category -->
                <StackLayout IsVisible="{Binding SelectedCategoryKey, Converter={StaticResource StringToVisibilityConverter}, ConverterParameter=AI Safety}"
                             Spacing="12">
                    <Label Text="{x:Static res:AppResources.SettingsPage_AiSafetySettingsTitle}"
                           FontSize="24"
                           FontAttributes="Bold"
                           AutomationId="AISafetySettingsTitle"
                           SemanticProperties.HeadingLevel="Level1"/>
                    <Label Text="{x:Static res:AppResources.SettingsPage_AiSafetySettingsComingSoon}"
                           FontSize="14"
                           TextColor="Gray"/>
                </StackLayout>

                <!-- Import/Export Category -->
                <StackLayout IsVisible="{Binding SelectedCategoryKey, Converter={StaticResource StringToVisibilityConverter}, ConverterParameter=Import/Export}"
                             Spacing="12">
                    <Label Text="{x:Static res:AppResources.SettingsPage_ImportExportSettingsTitle}"
                           FontSize="24"
                           FontAttributes="Bold"
                           AutomationId="ImportExportSettingsTitle"
                           SemanticProperties.HeadingLevel="Level1"/>
                    <Label Text="{x:Static res:AppResources.SettingsPage_ImportExportSettingsComingSoon}"
                           FontSize="14"
                           TextColor="Gray"/>
                </StackLayout>
            </StackLayout>
        </ScrollView>
    </Grid>
</ContentPage>

